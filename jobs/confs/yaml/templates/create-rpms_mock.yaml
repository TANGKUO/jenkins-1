- job-template: &create-rpms
    name: '{project}_{version}_create-rpms-{distro}-{arch}_{trigger}'
    node: '{node-filter}'
    defaults: create-rpms
    parameters:
      - gerrit-params:
          branch: '{branch}'
    scm:
      - '{project}-gerrit':
          git-server: '{git-server}'
      - jenkins:
          branch: master
          git-server: '{git-server}'
    triggers:
      - 'on-patch-{trigger}':
          project: '{project}'
          branch: '{branch}'
          gerrit-server: '{gerrit-server}'
    builders:
      - cleanup-slave
      - 'mock-{mock-build-type}':
          project: '{project}'
          distro: '{distro}'
          arch: '{arch}'
          extra-packages: '{extra-packages}'
          extra-build-packages: '{extra-build-packages}'
          extra-rpmbuild-options: '{extra-rpmbuild-options}'
          extra-autogen-options: '{extra-autogen-options}'
          extra-configure-options: '{extra-configure-options}'
          extra-repos: '{extra-repos}'
          extra-env: '{extra-env}'
          extra-make-targets: '{extra-make-targets}'
          cherry-pick: '{cherry-pick}'
          copy-in: '{copy-in}'
          copy-out: '{copy-out}'
    reponame: ovirt
    repotype: experimental
    publishers:
      - mock-cleanup
      - exported-artifacts
      - trigger-parameterized-builds:
        - project: 'deploy-to-{reponame}_{repotype}_{repoversion}'
          predefined-parameters: |
            BUILD_ID={project}_{distro}_$BUILD_NUMBER
            BUILD_ARTIFACTS_JOBS=$BUILD_URL
          condition: SUCCESS

- job-template: &no-deploy-create-rpms
    <<: *create-rpms
    name: 'no-deploy-create-rpms'
    publishers:
      - mock-cleanup
      - exported-artifacts

## Template for the releng-based jobs
- job-template: &releng-template
    name: '{subproject}_{version}_create-rpms-{distro}-{arch}_{trigger}'
    node: '{node-filter}'
    parameters:
      - gerrit-params:
          branch: '{branch}'
    scm:
      - '{project}-gerrit':
          git-server: '{git-server}'
      - jenkins:
          branch: master
          git-server: '{git-server}'
    triggers:
      - 'on-patch-{trigger}-with-files':
          project: '{project}'
          branch: '{branch}'
          files: 'specs/{subproject}/.*'
          gerrit-server: '{gerrit-server}'
    builders:
      - cleanup-slave
      - 'mock-{mock-build-type}-releng':
          project: '{project}'
          subproject: '{subproject}'
          distro: '{distro}'
          arch: '{arch}'
          extra-packages: '{extra-packages}'
          extra-build-packages: '{extra-build-packages}'
          extra-build-options: '{extra-build-options}'
          extra-rpmbuild-options: '{extra-rpmbuild-options}'
          extra-build-options: '{extra-build-options}'
          extra-repos: '{extra-repos}'
          extra-env: '{extra-env}'
          extra-make-targets: '{extra-make-targets}'
          cherry-pick: '{cherry-pick}'
    publishers:
      - mock-cleanup
      - exported-artifacts
      - trigger-parameterized-builds:
        - project: 'deploy-to-{reponame}_{repotype}_{repoversion}'
          predefined-parameters: |
            BUILD_ID={project}_{distro}_$BUILD_NUMBER
            BUILD_ARTIFACTS_JOBS=$BUILD_URL
          condition: SUCCESS

- job-template: &no-deploy-releng
    <<: *releng-template
    name: 'no-deploy-releng'
    publishers:
      - mock-cleanup
      - exported-artifacts

- job-template:
    <<: *no-deploy-releng
    name: 'jasperreports-server_{version}_create-rpms-{distro}-{arch}_{trigger}'

- job-template:
    <<: *no-deploy-releng
    name: 'ovirt-engine-wildfly-overlay8_{version}_create-rpms-{distro}-{arch}_{trigger}'

- job-template:
    <<: *no-deploy-releng
    name: 'ovirt-engine-wildfly-overlay10_{version}_create-rpms-{distro}-{arch}_{trigger}'

- job-template:
    <<: *no-deploy-releng
    name: 'slf4j_{version}_create-rpms-{distro}-{arch}_{trigger}'

- job-template:
    <<: *no-deploy-releng
    name: 'ovirt-engine-wildfly8_{version}_create-rpms-{distro}-{arch}_{trigger}'

- job-template:
    <<: *no-deploy-releng
    name: 'ovirt-engine-wildfly10_{version}_create-rpms-{distro}-{arch}_{trigger}'

- job-template:
    <<: *no-deploy-releng
    name: 'ebay-cors-filter_{version}_create-rpms-{distro}-{arch}_{trigger}'

- job-template:
    name: 'ovirt-engine_{version}_create-rpms-{distro}-{arch}_{trigger}'
    node: '{node-filter}'
    parameters:
      - gerrit-params:
          branch: '{branch}'
    scm:
      - '{project}-gerrit':
          git-server: '{git-server}'
      - jenkins:
          branch: master
          git-server: '{git-server}'
    triggers:
      - timed: "H */6 * * *"
    wrappers:
      - copy-to-slave:
          includes:
            - 'artifactory-ovirt-org-settings.xml'
          relative-to: 'userContent'
    builders:
      - cleanup-slave
      - 'mock-{mock-build-type}':
          project: '{project}'
          distro: '{distro}'
          arch: '{arch}'
          extra-packages: '{extra-packages}'
          extra-build-packages: '{extra-build-packages}'
          extra-rpmbuild-options: '{extra-rpmbuild-options}'
          extra-autogen-options: '{extra-autogen-options}'
          extra-configure-options: '{extra-configure-options}'
          extra-repos: '{extra-repos}'
          extra-env: '{extra-env}'
          extra-make-targets: '{extra-make-targets}'
          cherry-pick: '{cherry-pick}'
          copy-in: '{copy-in}'
    publishers:
      - mock-cleanup
      - exported-artifacts
      - trigger-parameterized-builds:
        - project: 'deploy-to-{reponame}_{repotype}_{version}'
          predefined-parameters: |
            BUILD_ID={project}_{distro}_$BUILD_NUMBER
            BUILD_ARTIFACTS_JOBS=$BUILD_URL
          condition: SUCCESS
