- job:
    name: jenkins_master_deploy-configs_merged
    node: master
    parameters:
      - bool:
          name: ARCHIVE_JOBS
          default: true
          description: "Archive jobs removed from yaml"
      - gerrit-params:
          branch: master
    triggers:
      - gerrit:
          trigger-on:
              - change-merged-event:
                  exclude-drafts: true
                  escape-quotes: true
          successful-message: 'Configuration deployed'
          projects:
              - project-compare-type: 'PLAIN'
                project-pattern: 'jenkins'
                branches:
                    - branch-compare-type: 'PLAIN'
                      branch-pattern: 'master'
                file-paths:
                    - compare-type: 'REG_EXP'
                      pattern: 'jobs/confs/.*'
    scm:
      - jenkins-master-gerrit
    builders:
      - shell: !include-raw shell-scripts/jenkins_deploy_yamls.sh
      - shell: !include-raw shell-scripts/jenkins_cleanup_yaml.sh
      - system-groovy:
          command: !include-raw groovy-scripts/archive_jobs.groovy
    publishers:
      - groovy-postbuild: !include-raw groovy-scripts/archive_jobs.postbuild.groovy

